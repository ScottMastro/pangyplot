<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>PangyPlot</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.svg') }}">

    <link rel="stylesheet" href="{{ url_for('static', filename='fontawesome/css/all.min.css') }}">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">   
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fonts.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/ui/navbar-style.css') }}">   
    <link rel="stylesheet" href="{{ url_for('static', filename='css/ui/modal-style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/cytoband/cytoband-style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/ui/gene-search-style.css') }}">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/ui/coordinates-style.css') }}">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/ui/option-button.css') }}">   
    <link rel="stylesheet" href="{{ url_for('static', filename='css/ui/color-picker.css') }}">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/graph/graph.css') }}">

</head>

<body class="flex-col">

{% include 'navbar-template.html' %}
{% include 'cytoband-template.html' %}

<div class="flex-row fixed-height-1">

    {% include 'gene-search-template.html' %}
    {% include 'coordinate-template.html' %}

</div>


<div class="flex-row fixed-height-1">
    
    {% include 'color-picker.html' %}

</div>


<div id="graph-container">

    {% include 'graph.html' %}

</div>



<button id="download-image-button">Download Image</button>

<select id="path-selector" name="path-selector">
    <!-- The options will be appended here by JavaScript -->
</select>
<input type="submit" value="Submit">


<script>

    function getFormattedDateTime() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        return `${year}-${month}-${day}_${hours}-${minutes}-${seconds}`;
    }

    document.getElementById('download-image-button').addEventListener('click', function() {
        const canvas = document.querySelector('.force-graph-container canvas');
        if (!canvas) {
            console.error('Canvas element not found');
            return;
        }
    
        const dateTimeStr = getFormattedDateTime();
        const dataUrl = canvas.toDataURL('image/png');
        const link = document.createElement('a');
        link.download = `pangyplot_${dateTimeStr}.png`;
        link.href = dataUrl;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);    
    });
</script>

<script src="{{url_for('static', filename='js/d3/d3.js')}}"></script>
<script src="{{url_for('static', filename='js/d3/d3-annotation.min.js')}}"></script>
<script src="{{url_for('static', filename='js/d3/force-graph.min.js')}}"></script>

<script src="{{url_for('static', filename='js/ui/navbar.js')}}"></script>
<script src="{{url_for('static', filename='js/ui/modal.js')}}"></script>

<script src="{{url_for('static', filename='js/cytoband/other-chromosomes.js')}}"></script>
<script src="{{url_for('static', filename='js/cytoband/cytoband.js')}}"></script>
<script src="{{url_for('static', filename='js/cytoband/cytoband-genome.js')}}"></script>
<script src="{{url_for('static', filename='js/cytoband/cytoband-genome-drawer.js')}}"></script>
<script src="{{url_for('static', filename='js/cytoband/cytoband-chromosome.js')}}"></script>
<script src="{{url_for('static', filename='js/cytoband/cytoband-chromosome-drawer.js')}}"></script>

<script src="{{url_for('static', filename='js/graph/graph-construct.js')}}"></script>
<script src="{{url_for('static', filename='js/graph/graph-collapse.js')}}"></script>
<script src="{{url_for('static', filename='js/graph/graph-annotations.js')}}"></script>
<script src="{{url_for('static', filename='js/graph/graph.js')}}"></script>
<script src="{{url_for('static', filename='js/graph/graph-fetch.js')}}"></script>
<script src="{{url_for('static', filename='js/graph/draw-helper.js')}}"></script>
<script src="{{url_for('static', filename='js/graph/graph-select.js')}}"></script>
<script src="{{url_for('static', filename='js/graph/path-manager.js')}}"></script>

<script src="{{url_for('static', filename='js/ui/option-button.js')}}"></script>
<script src="{{url_for('static', filename='js/ui/color-picker.js')}}"></script>
<script src="{{url_for('static', filename='js/ui/gene-search.js')}}"></script>
<script src="{{url_for('static', filename='js/ui/coordinates.js')}}"></script>

</body>
</html>

