<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>PangyPlot</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.svg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='fontawesome/css/all.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/cytoband.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/colors.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">   
    <link rel="stylesheet" href="{{ url_for('static', filename='css/option-button.css') }}">   
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">   
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fonts.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/citation-modal.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/gene-search.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/position-go.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/color-picker.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/graph.css') }}">

</head>

<body>


<div id="navbar" class="container fixed-height-1">

    {% include 'navbar.html' %}
    {% include 'citation-modal.html' %}

</div>


<div id="cytoband-div" class="fixed-height-2-5">

    {% include 'cytoband.html' %}

</div>

<div id="position-div" style="display:flex;width:100%;" class="fixed-height-1">

    <div id="gene-search-container" class="container">
        <div class="container-title">Select by Gene</div>

        <div id="gene-search-container-content" class="container-content">
            <i class="fa fa-search"></i>

            <div id="gene-search-bar-container">
                <input type="text" id="gene-search-bar" placeholder="Search genes...">
                <div id="gene-suggestions" class="suggestions-dropdown"></div>
            </div>

            <div id="selected-gene-container">
                <div id="gene-selected-1" class="gene-selected-placeholder placeholder-blank option-button option-button-unselected"></div>
                <div id="gene-selected-2" class="gene-selected-placeholder placeholder-blank option-button option-button-unselected"></div>
                <div id="gene-selected-3" class="gene-selected-placeholder placeholder-blank option-button option-button-unselected"></div>
            </div>
        </div>
    </div>

    <div id="position-select-container" class="container">
        <div class="container-title">Select by Position</div>

        <div id="position-select-container-content" class="container-content">
            <i class="fa-solid fa-location-crosshairs"></i>           

            <input type="text" id="gene-search-bar" placeholder="chr:start-end">
        </div>
    </div>

    <div id="go-container" class="container">
        <div class="container-title">Go</i></div>

        <div id="go-container-content" class="container-content">
            <div id="go-chrom-start-end">
                <span id="go-chrom" class="important-text"><i class="fa-regular fa-square"></i></span>
                <span class="less-important-text">:</span>
                <span id="go-start" class="important-text"><i class="fa-regular fa-square"></i></span>
                <span class="less-important-text">-</span>
                <span id="go-end" class="important-text"><i class="fa-regular fa-square"></i></span>
            </div>
            <button id="go-button">Go <i class="fa-solid fa-bolt-lightning"></i></button>
        </div>
    </div>

</div>

<div id="color-div" class="fixed-height-1">
    
    {% include 'color-picker.html' %}

</div>

<div id="graph-container">

    {% include 'graph.html' %}

</div>

<button id="download-image-button">Download Image</button>

<select id="path-selector" name="path-selector">
    <!-- The options will be appended here by JavaScript -->
</select>
<input type="submit" value="Submit">


<script>

    function getFormattedDateTime() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        return `${year}-${month}-${day}_${hours}-${minutes}-${seconds}`;
    }

    document.getElementById('download-image-button').addEventListener('click', function() {
        const canvas = document.querySelector('.force-graph-container canvas');
        if (!canvas) {
            console.error('Canvas element not found');
            return;
        }
    
        const dateTimeStr = getFormattedDateTime();
        const dataUrl = canvas.toDataURL('image/png');
        const link = document.createElement('a');
        link.download = `pangyplot_${dateTimeStr}.png`;
        link.href = dataUrl;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);    
    });
</script>

<script src="{{url_for('static', filename='javascript/force-graph.min.js')}}"></script>
<script src="{{url_for('static', filename='javascript/d3.js')}}"></script>
<script src="{{url_for('static', filename='javascript/d3-annotation.min.js')}}"></script>
<script src="{{url_for('static', filename='javascript/ui/cytoband/other-chromosomes.js')}}"></script>
<script src="{{url_for('static', filename='javascript/ui/cytoband/cytoband.js')}}"></script>
<script src="{{url_for('static', filename='javascript/ui/cytoband/genome-drawer.js')}}"></script>
<script src="{{url_for('static', filename='javascript/ui/cytoband/chromosome-drawer.js')}}"></script>

<script src="{{url_for('static', filename='javascript/graph-construct.js')}}"></script>
<script src="{{url_for('static', filename='javascript/graph-collapse.js')}}"></script>
<script src="{{url_for('static', filename='javascript/graph-annotations.js')}}"></script>
<script src="{{url_for('static', filename='javascript/graph.js')}}"></script>

<script src="{{url_for('static', filename='javascript/draw-helper.js')}}"></script>
<script src="{{url_for('static', filename='javascript/graph-select.js')}}"></script>
<script src="{{url_for('static', filename='javascript/path-manager.js')}}"></script>
<script src="{{url_for('static', filename='javascript/ui/option-button.js')}}"></script>
<script src="{{url_for('static', filename='javascript/ui/citation-modal.js')}}"></script>
<script src="{{url_for('static', filename='javascript/ui/color-picker.js')}}"></script>
<script src="{{url_for('static', filename='javascript/ui/gene-search.js')}}"></script>
<script src="{{url_for('static', filename='javascript/ui/position-go.js')}}"></script>

</body>
</html>

